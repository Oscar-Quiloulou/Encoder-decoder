<!doctype html>
<html lang="fr">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Page Cyber-Exemple - Encodeur Multi-mode + Chat Firebase</title>
    
    <!-- Chargement des librairies Firebase (CDN) -->
    <!-- Le 'app' est nécessaire pour l'initialisation -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <!-- Le 'database' est nécessaire pour la Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <style>
        /* BASE FUTURISTE (inchangée) */
        :root{
            --bg: #141b26;      
            --card: #0d121b;    
            --accent: #00ffc4;  
            --text: #e6f7ff;    
            --muted: #5e7087;   
            --border: #2c3a50;  
            --glow: 0 0 15px rgba(0, 255, 196, 0.4); 
            --radius: 4px;
            --max: 1200px;
        }
        *{box-sizing:border-box}
        body{
            margin:0;
            font-family:'Courier New', monospace; 
            background:var(--bg);
            color:var(--text);
            -webkit-font-smoothing:antialiased;
            line-height:1.6;
            padding-bottom: 250px; 
        }
        .wrap{max-width:var(--max); margin:40px auto; padding:0 24px;}
        header{display:flex; align-items:center; justify-content:space-between; gap:20px; margin-bottom:40px; border-bottom:1px solid var(--border); padding-bottom:15px;}
        .brand{display:flex; align-items:center; gap:16px;}
        .logo{width:54px; height:54px; background:var(--accent); border-radius:var(--radius); display:inline-block; box-shadow:var(--glow);}
        .brand strong{font-size:1.4rem; color:var(--accent); text-shadow:var(--glow);}
        .brand .muted{font-size:.75rem;}
        nav ul{list-style:none; padding:0; margin:0; display:flex; gap:20px; align-items:center;}
        nav a{color:var(--muted); text-decoration:none; font-weight:700; transition:color 0.3s;}
        nav a:hover{color:var(--accent); text-shadow:var(--glow);}
        .hero{
            background:var(--card);
            padding:36px;
            border-radius:var(--radius);
            display:flex;
            gap:30px;
            align-items:center;
            margin-bottom:30px;
            border:1px solid var(--border);
            box-shadow:0 0 20px rgba(0, 255, 196, 0.1);
        }
        .hero .left{flex:1}
        .hero h1{margin:0 0 10px; font-size:2rem; color:var(--accent);}
        .hero p{margin:0 0 16px; color:var(--muted)}
        .btn{
            display:inline-block;
            background:var(--accent);
            color:var(--card);
            padding:12px 18px;
            border-radius:var(--radius);
            text-decoration:none;
            font-weight:700;
            transition: all 0.3s;
            text-transform: uppercase;
            box-shadow:var(--glow);
            border:none;
            cursor: pointer;
        }
        .btn:hover{
            background: #00ffdd;
            box-shadow: 0 0 20px rgba(0, 255, 196, 0.8);
        }
        .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); gap:20px; margin-bottom:30px;}
        .card{
            background:var(--card);
            padding:20px;
            border-radius:var(--radius);
            border:1px solid var(--border);
            box-shadow:0 0 10px rgba(0, 255, 196, 0.05);
        }
        .card h3{margin:0 0 10px; font-size:1.15rem; color:var(--accent);}
        .muted{color:var(--muted); font-size:0.9rem}
        .encoder-controls{
            display:flex;
            gap:10px;
            margin-top:10px;
        }
        form{display:grid; gap:12px;}
        input,textarea,select{ 
            width:100%;
            padding:12px;
            border:1px solid var(--border);
            border-radius:var(--radius);
            font-size: 1rem;
            font-family:'Courier New', monospace; 
            background:var(--bg);
            color:var(--text);
            box-shadow:inset 0 0 5px rgba(0, 255, 196, 0.1);
            transition:border-color 0.3s;
        }
        input:focus,textarea:focus,select:focus{
            outline:none;
            border-color:var(--accent);
            box-shadow:inset 0 0 10px rgba(0, 255, 196, 0.3);
        }
        #shiftAmount{
            width: 80px;
            text-align: center;
            display: inline-block;
        }
        .cipher-info{
            background: var(--bg);
            border: 1px dashed var(--border);
            padding: 10px;
            border-radius: var(--radius);
            font-size: 0.8rem;
            word-break: break-all;
        }
        .mode-settings{
            margin-top: 15px;
            padding: 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
        }
        footer{margin:40px 0 20px; color:var(--muted); text-align:center; font-size:0.85rem; padding-top:15px; border-top:1px dashed var(--border);}
        #chatTerminal {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 200px;
            background: var(--card); 
            border-top: 2px solid var(--accent);
            padding: 10px;
            box-shadow: 0 -5px 20px rgba(0, 255, 196, 0.15);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }
        #chatDisplay {
            flex-grow: 1;
            overflow-y: auto;
            margin-bottom: 10px;
            padding-right: 10px; 
            font-size: 0.8rem;
            color: var(--text);
        }
        #chatDisplay::-webkit-scrollbar {
            width: 8px;
        }
        #chatDisplay::-webkit-scrollbar-thumb {
            background-color: var(--muted);
            border-radius: 4px;
        }
        .chat-message {
            margin-bottom: 5px;
            line-height: 1.3;
        }
        .chat-system {
            color: var(--accent);
        }
        .chat-user {
            color: #8b5cf6; 
        }
        #chatInputForm {
            display: flex;
            gap: 10px;
        }
        #chatInput {
            flex-grow: 1;
            padding: 8px;
            height: auto;
        }
        #chatSendBtn {
            padding: 8px 15px;
            font-size: 0.8rem;
            min-width: 80px;
        }
        @media (max-width:600px){
            .hero{flex-direction:column; align-items:flex-start}
            header{flex-direction:column; align-items:flex-start}
            .wrap{padding:0 15px;}
            .encoder-controls{flex-direction: column;}
            #chatTerminal {
                height: 150px; 
            }
            body {
                padding-bottom: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div class="brand">
                <span class="logo" aria-hidden="true"></span>
                <div>
                    <strong>CYBER-BASE</strong><div class="muted">PROTOCOLE EN LIGNE V3.1</div>
                </div>
            </div>
            <nav aria-label="Navigation principale">
                <ul>
                    <li><a href="#home">/ ACCUEIL</a></li>
                    <li><a href="#features">/ FONCTIONS</a></li>
                    <li><a href="#encoder">/ ENCODEUR</a></li>
                </ul>
            </nav>
        </header>

        <main>
            <section class="hero" id="home">
                <div class="left">
                    <h1>SYSTÈME EN LIGNE OPÉRATIONNEL</h1>
                    <p class="muted">Interface de base pour la navigation. Modifiez les paramètres pour un accès complet.</p>
                    <a class="btn" href="#" target="_blank">ACCÈS PROTOCOLE</a>
                    <a class="btn" href="#encoder" style="background:#4a5568; box-shadow:none;">OUVRIR ENCODEUR</a>
                </div>
                <div style="min-width:180px; text-align:right;">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 120'%3E%3Crect rx='4' width='160' height='120' fill='%231f2937'/%3E%3Cpath d='M 10 30 L 150 30 L 150 100 L 10 100 Z' stroke='%2300ffc4' stroke-width='2' fill='none'/%3E%3Ccircle cx='30' cy='50' r='5' fill='%2300ffc4'/%3E%3Cpath d='M 40 50 L 140 50 M 30 70 L 130 70 M 50 90 L 110 90' stroke='%235e7087' stroke-width='1'/%3E%3Ctext x='80' y='65' font-family='Courier New' font-size='10' fill='%2300ffc4' text-anchor='middle'%3E[DONNÉES CHIFFRÉES]%3C/text%3E%3C/svg%3E" alt="Interface futuriste" aria-hidden="true" style="border-radius:4px;">
                </div>
            </section>

            <section id="features" class="grid" aria-label="Fonctionnalités du Système">
                <article class="card">
                    <h3>01. AUDIT DE SÉCURITÉ</h3>
                    <p class="muted">Analyse des dépendances du système et des ports ouverts pour détecter les vulnérabilités.</p>
                </article>
                <article class="card">
                    <h3>02. TÉLÉMÉTRIE TEMPS RÉEL</h3>
                    <p class="muted">Surveillance de l'état du réseau (latence, flux de données) avec mise à jour immédiate.</p>
                </article>
                <article class="card">
                    <h3>03. CONFIGURATION PAR CLÉ</h3>
                    <p class="muted">Paramétrage rapide des protocoles via une clé alphanumérique personnalisable (encodeur).</p>
                </article>
            </section>

            <section id="encoder" class="card" aria-labelledby="encoder-title">
                <h3 id="encoder-title">MODULE DE CHIFFREMENT DE PROTOCOLE</h3>
                
                <form id="modeForm">
                    <label>
                        <span class="muted">Sélection du Mode de Transformation</span>
                        <select id="cipherMode">
                            <option value="caesar">01. Décalage Alphabétique (CÉSAR)</option>
                            <option value="vowel_sub">02. Substitution Voyelles-Numériques (A=1, E=2...)</option>
                        </select>
                    </label>
                </form>

                <div id="caesarSettings" class="mode-settings">
                    <h4 style="margin-top:0; color:var(--accent); font-size:1rem;">PARAMÈTRES CÉSAR</h4>
                    <label style="display: flex; align-items: center; gap: 10px;">
                        <span class="muted" style="white-space: nowrap;">Décalage de la Clé (0-25) :</span>
                        <input type="number" id="shiftAmount" value="1" min="0" max="25" style="width: 80px;">
                    </label>
                    
                    <div class="encoder-controls" style="margin-top: 15px;">
                        <button type="button" class="btn" id="saveShift">ACTIVER DÉCALAGE</button>
                        <button type="button" class="btn" id="resetShift" style="background:#4a5568; box-shadow:none;">RÉINITIALISER (DÉCALAGE 1)</button>
                    </div>
                    
                    <div class="cipher-info" style="margin-top: 15px;">
                        **Clé Active :** **Décalage** <span id="currentShiftDisplay" class="muted">1</span> | **A →** <span id="aTargetDisplay" class="muted">B</span>
                    </div>
                </div>

                <div id="vowelSettings" class="mode-settings" style="display: none;">
                    <h4 style="margin-top:0; color:var(--accent); font-size:1rem;">PARAMÈTRES VOYELLES</h4>
                    <div class="cipher-info">
                        **Règles de Substitution :** A=1, E=2, I=3, O=4, U=5 | Les consonnes et autres caractères sont inchangés.
                    </div>
                </div>
                
                <hr style="border-color: var(--border); margin: 20px 0;">

                <form id="codeForm">
                    <label>
                        <span class="muted">Séquence d'Entrée (TEXTE CLAIR / CODE)</span>
                        <textarea id="inputText" rows="4" placeholder="Tapez le message à transformer ici..."></textarea>
                    </label>
                    <div class="encoder-controls">
                        <button type="button" class="btn" id="encodeBtn">ENCODER SÉQUENCE</button>
                        <button type="button" class="btn" id="decodeBtn" style="background:#8b5cf6; box-shadow:0 0 15px rgba(139, 92, 246, 0.4);">DÉCODER SÉQUENCE</button>
                    </div>
                    <label>
                        <span class="muted">Séquence de Sortie (CODE TRANSFORMÉ / TEXTE CLAIR)</span>
                        <textarea id="outputText" rows="4" readonly placeholder="Le résultat apparaîtra ici..."></textarea>
                    </label>
                </form>
            </section>
        </main>

        <footer>
            &copy; <span id="year"></span> CYBER-BASE — Protocole Firebase.
        </footer>
    </div>
    
    <div id="chatTerminal">
        <div id="chatDisplay">
            <!-- Messages chargés par Firebase -->
        </div>
        <form id="chatInputForm">
            <input type="text" id="chatInput" placeholder="Saisir le message chiffré ou le code..." required>
            <button type="submit" class="btn" id="chatSendBtn">ENVOYER</button>
        </form>
    </div>

    <script>
        document.getElementById('year').textContent = new Date().getFullYear();

        // --- CONFIGURATION FIREBASE (Vos clés) ---
        const firebaseConfig = {
            apiKey: "AIzaSyDsKu6EavK4oEh4F2TS0EoB5HwzMxY7kgU",
            authDomain: "chat-encode.firebaseapp.com",
            databaseURL: "https://chat-encode-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "chat-encode",
            storageBucket: "chat-encode.firebasestorage.app",
            messagingSenderId: "812767464816",
            appId: "1:812767464816:web:e46750b8cfda20063c93b5",
            // measurementId n'est pas utilisé pour le chat de base
        };
        
        // Initialiser Firebase
        firebase.initializeApp(firebaseConfig);

        // Référence à la partie de la BDD (Realtime Database)
        const messagesRef = firebase.database().ref('chat/messages');
        
        // Identifiant unique pour cette session (pour différencier VOS messages)
        const userId = 'USER-' + Math.floor(Math.random() * 100000).toString(16).toUpperCase(); 

        // --- Logique de l'Encodeur de Code (inchangée) ---
        
        const ALPHABET = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const ALPHABET_LENGTH = ALPHABET.length;
        const VOWELS_TO_NUM = {'A': '1', 'E': '2', 'I': '3', 'O': '4', 'U': '5'};
        const NUM_TO_VOWELS = {'1': 'A', '2': 'E', '3': 'I', '4': 'O', '5': 'U'};
        
        let currentShift = 1; 
        let activeMode = 'caesar';

        const cipherModeSelect = document.getElementById('cipherMode');
        const caesarSettingsDiv = document.getElementById('caesarSettings');
        const vowelSettingsDiv = document.getElementById('vowelSettings');
        const shiftAmountInput = document.getElementById('shiftAmount');
        const currentShiftDisplay = document.getElementById('currentShiftDisplay');
        const aTargetDisplay = document.getElementById('aTargetDisplay');
        const inputTextarea = document.getElementById('inputText');
        const outputTextarea = document.getElementById('outputText');

        function getShiftedChar(index, shift) {
            return ALPHABET[(index + shift) % ALPHABET_LENGTH];
        }

        function transformCaesar(text, direction) {
            let result = '';
            const shift = direction === 'encode' ? currentShift : ALPHABET_LENGTH - currentShift;
            for (let i = 0; i < text.length; i++) {
                const char = text[i].toUpperCase();
                const index = ALPHABET.indexOf(char);
                if (index !== -1) {
                    result += getShiftedChar(index, shift);
                } else {
                    result += text[i];
                }
            }
            return result;
        }

        function transformVowelSub(text, direction) {
            let mapping;
            if (direction === 'encode') {
                mapping = VOWELS_TO_NUM;
            } else {
                mapping = NUM_TO_VOWELS;
            }
            let result = '';
            for (let i = 0; i < text.length; i++) {
                const char = direction === 'encode' ? text[i].toUpperCase() : text[i];
                if (mapping[char]) {
                    result += mapping[char];
                } else {
                    result += text[i];
                }
            }
            return result;
        }

        function updateSettingsVisibility() {
            activeMode = cipherModeSelect.value;
            if (activeMode === 'caesar') {
                caesarSettingsDiv.style.display = 'block';
                vowelSettingsDiv.style.display = 'none';
                updateShiftDisplay();
            } else if (activeMode === 'vowel_sub') {
                caesarSettingsDiv.style.display = 'none';
                vowelSettingsDiv.style.display = 'block';
            }
        }
        
        function updateShiftDisplay() {
            currentShiftDisplay.textContent = currentShift;
            aTargetDisplay.textContent = getShiftedChar(0, currentShift); 
        }

        cipherModeSelect.addEventListener('change', updateSettingsVisibility);

        document.getElementById('saveShift').addEventListener('click', () => {
            const newShift = parseInt(shiftAmountInput.value);
            if (newShift >= 0 && newShift < ALPHABET_LENGTH) {
                currentShift = newShift;
                updateShiftDisplay();
                alert(`Décalage activé : A → ${getShiftedChar(0, currentShift)}.`);
            } else {
                alert('ERREUR : Le décalage doit être un nombre entier entre 0 et 25.');
                shiftAmountInput.value = currentShift;
            }
        });

        document.getElementById('resetShift').addEventListener('click', () => {
            currentShift = 1;
            shiftAmountInput.value = currentShift;
            updateShiftDisplay();
            alert('Décalage réinitialisé à 1 (A → B).');
        });
        
        document.getElementById('encodeBtn').addEventListener('click', () => {
            const inputText = inputTextarea.value;
            let result = '';
            if (activeMode === 'caesar') {
                result = transformCaesar(inputText, 'encode');
            } else if (activeMode === 'vowel_sub') {
                result = transformVowelSub(inputText, 'encode');
            }
            outputTextarea.value = result;
        });

        document.getElementById('decodeBtn').addEventListener('click', () => {
            const inputText = inputTextarea.value;
            let result = '';
            if (activeMode === 'caesar') {
                result = transformCaesar(inputText, 'decode');
            } else if (activeMode === 'vowel_sub') {
                result = transformVowelSub(inputText, 'decode');
            }
            outputTextarea.value = result;
        });


        // --- Logique du Chat Terminal avec Firebase (Réel) ---
        const chatDisplay = document.getElementById('chatDisplay');
        const chatInput = document.getElementById('chatInput');
        const chatInputForm = document.getElementById('chatInputForm');
        
        function appendMessage(message, type) {
            const msgDiv = document.createElement('div');
            const timestamp = new Date().toLocaleTimeString('fr-FR', {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            msgDiv.className = `chat-message chat-${type}`;
            msgDiv.innerHTML = `[${timestamp}] ${message}`;
            chatDisplay.appendChild(msgDiv);
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        }

        // Événement d'envoi du message (PUSH vers Firebase)
        chatInputForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const userMessage = chatInput.value.trim();

            if (userMessage) {
                // PUSH le message dans la base de données Firebase
                messagesRef.push({
                    text: userMessage,
                    senderId: userId,
                    timestamp: firebase.database.ServerValue.TIMESTAMP
                });

                chatInput.value = ''; // Effacer le champ
            }
        });
        
        // Événement de réception des messages (écoute en temps réel)
        // 'child_added' est déclenché pour chaque message existant et pour chaque nouveau message
        // limitToLast(200) charge les 200 derniers messages pour éviter de surcharger
        messagesRef.limitToLast(200).on('child_added', (snapshot) => {
            const data = snapshot.val();
            // Vérifie si l'expéditeur est l'utilisateur actuel
            const isUser = data.senderId === userId;
            const senderTag = isUser ? '[VOUS]' : `[ID:${data.senderId}]`;
            // Utilise la classe 'user' pour vos messages, 'system' pour les autres
            const type = isUser ? 'user' : 'system'; 
            
            // Affichage du message
            appendMessage(`${senderTag} : ${data.text}`, type);
        });

        // Message de statut au démarrage
        appendMessage(`[SYSTEM] : Canal configuré. Votre ID utilisateur est: ${userId}. Statut: EN LIGNE.`, 'system');


        // --- Initialisation ---
        shiftAmountInput.value = currentShift;
        updateSettingsVisibility();
    </script>
</body>
</html>
